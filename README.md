# ABM Social Media & Sleep Model

This repository contains an Agent-Based Model (ABM) that simulates the relationship between nighttime social media use and sleep duration in adolescents. This work was developed by **Şiyar Tarık Özcaner** in collaboration with the **Erasmus University Movez Lab** during an internship.

## Table of Contents

- [Overview](#overview)
- [Features](#features)
- [Installation and Requirements](#installation-and-requirements)
- [CSV File Formats](#csv-file-formats)
  - [Initialization Data CSV](#initialization-data-csv)
  - [Social Network CSV](#social-network-csv)
- [How the Simulation Works](#how-the-simulation-works)
  - [Agent Initialization](#agent-initialization)
    - [Normal Initialization Mode](#normal-initialization-mode)
    - [Empirical Initialization Mode](#empirical-initialization-mode)
    - [CSV Initialization Mode](#csv-initialization-mode)
  - [Agent Update Function](#agent-update-function)
    - [Nighttime Social Media Use Calculation](#nighttime-social-media-use-calculation)
    - [Sleep Duration Calculation](#sleep-duration-calculation)
- [CSV Outputs](#csv-outputs)
- [Usage](#usage)
- [Contributing](#contributing)
- [License](#license)
- [Persistent Settings](#persistent-settings)
- [Code Documentation & Comments](#code-documentation--comments)

## Overview

This ABM implementation simulates a population of adolescents over a user-defined number of days. Each agent has several static and dynamic attributes that evolve during the simulation. The model captures complex feedback loops between social media use and sleep behavior while considering external factors such as household rules and social networks.

The simulation supports three initialization methods for agent parameters: **Normal**, **Empirical**, and **CSV-based**. Additionally, it provides detailed CSV outputs (both per-agent and per-run) and a graphical interface using Tkinter.

## Features

- **Flexible Agent Initialization:**
  - **Normal Initialization Mode:**  
    Agents are generated by sampling from a normal distribution with user-specified mean, standard deviation, minimum, and maximum values.
  - **Empirical Initialization Mode:**  
    Agents are generated by sampling from an empirical distribution defined by a list of values and their corresponding probabilities.
  - **CSV Initialization Mode:**  
    Agent attributes (including sex, initial sleep duration, nighttime social media use, and household restrictions) are loaded from a CSV file.

- **Dynamic Agent Update:**
  - The update function calculates each agent's nighttime social media use and sleep duration on a daily basis.  
  - **Nighttime Social Media Use** is updated based on:
    - The agent’s baseline SM use (set based on sex).
    - The social norm derived from the agent’s friends.
    - A weighted difference between the social norm and the baseline.
    - A weekend effect that increases SM use on Saturdays and Sundays.
    - Random noise.
    - Capping by any household restrictions.
  - **Sleep Duration** is updated based on:
    - A global baseline sleep duration.
    - A reduction factor proportional to the updated nighttime SM use, determined by a sleep effect coefficient.
    - Random noise.
    - A floor of zero so that sleep duration never goes negative.
    
  The formulas used are as follows:

  **Nighttime SM Use Calculation:**
  ```
  new_SM = baseline_SM + Weight_Social_Norm * (social_norm - baseline_SM)
           + [Day-of-Week Effect if weekend] + noise_SM
  ```
  *(After capping by household restrictions and ensuring the value is non-negative.)*

  **Sleep Duration Calculation:**
  ```
  new_sleep = Global_Baseline_Sleep - Sleep_Effect_Coefficient * new_SM + noise_sleep
  ```
  *(Then floored at 0.)*

- **Social Network:**
  - Social networks can be randomly generated or imported from a CSV file.

- **Multiple Simulation Runs:**
  - Run multiple simulations with different random seeds for robustness analysis.

- **Output Files:**
  - **Per-Agent Output CSV:** Detailed daily data for each agent.
  - **Per-Run Output CSV:** Daily population average data for each simulation run.

- **User Interface:**
  - A Tkinter-based GUI with organized parameter groups (Simulation, Initialization, Model, and Output Options) including type/unit indicators.
  - A "Reset to Defaults" button for reverting non‑file-path settings.
  - **Persistent Settings:** All parameter values, including file paths, are saved in a JSON file so that users do not have to re-enter any values upon subsequent runs.

## Installation and Requirements

- **Python Version:**  
  This project requires a minimum of Python 3.8.

- **Required Packages:**  
  Install the required packages with:
  ```bash
  pip install -r requirements.txt
  ```
  The `requirements.txt` file includes:
  - `numpy>=1.20.0`
  - `matplotlib>=3.3.0`

- **Tkinter:**  
  Tkinter is included with the standard Python distribution on Windows and macOS.  
  On some Linux distributions, Tkinter might not be installed by default. For example, on Ubuntu:
  ```bash
  sudo apt-get install python3-tk
  ```

## CSV File Formats

### Initialization Data CSV

The initialization CSV provides the starting conditions for each agent and should contain the following columns (case-insensitive):

- **agentid**: Unique identifier for the agent (integer).
- **sex**: Agent's sex (`male` or `female`).
- **sleep_duration**: Initial sleep duration in hours.
- **social_media_use**: Initial nighttime social media use in hours.
- **household_restriction**: Maximum allowed nighttime social media use in hours (or a special value such as 999 to indicate no restriction).

**Example:**

```csv
agentid,sex,sleep_duration,social_media_use,household_restriction
1,male,7,1,1
2,female,8,1,2
3,female,6,2,2
4,male,8,3,3
5,male,7,2,999
6,male,6,1,999
7,female,7,2,999
8,male,6,4,999
9,female,5,3,999
10,female,10,0,0
```

### Social Network CSV

The social network CSV describes the social connections among agents. One acceptable format is:

- **agentid**: The ID of the agent.
- **friendid**: The ID of a friend.
- **weight**: The weight of the connection (this value is read but not used in the simulation).

**Example:**

```csv
agentid,friendid,weight
1,2,0.75
1,3,0.25
1,4,0.25
1,5,0.25
...
```

## How the Simulation Works

### Agent Initialization

The simulation supports three initialization methods:

#### Normal Initialization Mode

Agents are generated by sampling from a normal distribution. The parameters for this mode are provided as:
- **Mean, Std, Min, Max (hours)** for sleep duration.
- **Mean, Std, Min, Max (minutes)** for nighttime social media use.

#### Empirical Initialization Mode

Agents are generated by sampling from an empirical distribution. In this mode, you define:
- A list of possible values.
- A corresponding list of probabilities.

These values are used to assign sleep duration and nighttime social media use.

#### CSV Initialization Mode

Agent attributes are read from a CSV file. The CSV must contain the required columns: `agentid` (or `id`), `sex`, `sleep_duration`, `social_media_use`, and `household_restriction`.

### Agent Update Function

For each simulation day, the `update_agent` function updates every agent’s nighttime social media use and sleep duration.

#### Nighttime Social Media Use Calculation

1. **Baseline Influence:**  
   Each agent has a static baseline SM use (set based on sex).

2. **Social Norm:**  
   The average SM use among an agent's friends is computed. If there are no friends, the baseline is used.

3. **Weighted Update:**  
   The new SM use is computed as:  
   ```
   new_SM = baseline_SM + Weight_Social_Norm * (social_norm - baseline_SM)
   ```
4. **Day-of-Week Effect:**  
   On weekends (typically Saturday and Sunday), a specified `Day-of-Week Effect` is added.

5. **Random Noise:**  
   A noise term (from the range defined by `Noise Range for SM (hrs)`) is added.

6. **Household Restriction:**  
   The new SM use is capped to the household restriction (if any).

7. **Final Adjustment:**  
   The new SM use is ensured to be at least 0.

#### Sleep Duration Calculation

The new sleep duration is calculated using the formula:
```
new_sleep = Global_Baseline_Sleep - Sleep_Effect_Coefficient * new_SM + noise_sleep
```
where:
- **Global_Baseline_Sleep:** A fixed baseline sleep duration for the population.
- **Sleep_Effect_Coefficient:** A factor that determines how much the new SM use reduces sleep.
- **noise_sleep:** A random noise term (from the range defined by `Noise Range for Sleep (hrs)`).

After computing the value, the sleep duration is floored at 0 to ensure it never becomes negative.

Each agent’s updated values are appended to their history lists (without including the initial state), so the history length equals the number of simulation days.

## CSV Outputs

The model produces two types of CSV outputs, both using standard comma-separated formatting with a header row.

### Per-Agent Output CSV

This CSV contains detailed daily data for every agent across all simulation runs. The file includes:

- **Run:** The simulation run number.
- **AgentID:** The unique identifier for the agent.
- **Day:** The simulation day (from 1 to the simulation duration).
- **SleepDuration:** The agent's sleep duration on that day (in hours).
- **NightSMUse:** The agent's nighttime social media use on that day (in hours).

Each row represents one agent’s data for a specific day. For multiple simulation runs, the "Run" column distinguishes between runs.

### Per-Run Output CSV

This CSV contains daily population average data for each simulation run. The file includes:

- **Run:** The simulation run number.
- **Day:** The simulation day.
- **AvgSleepDuration:** The average sleep duration across all agents for that day (in hours).
- **AvgNightSMUse:** The average nighttime SM use across all agents for that day (in hours).

Each row represents the aggregated averages for one simulation run.

## Usage

1. **Clone the Repository:**
   ```bash
   git clone https://github.com/neversaynotome/Movez-ABM.git
   cd Movez-ABM
   ```
   *(Note: The main file is named `abm.py`.)*

2. **Prepare CSV Files:**  
   Ensure your CSV files (initialization data and social network) are formatted as described above.

3. **Install Dependencies:**
   ```bash
   pip install -r requirements.txt
   ```

4. **Run the Simulation:**
   ```bash
   python abm.py
   ```
   Use the GUI to set parameters, choose the initialization mode (Normal, Empirical, or CSV), and set output CSV file paths for both per-agent and per-run outputs. Click **Run Simulation** to start.

5. **Output Files:**  
   After the simulation, the specified CSV files will contain the detailed outputs, and graphs will be displayed.

## Contributing

Contributions are welcome! If you have suggestions for improvements, bug fixes, or new features, please open an issue or submit a pull request. Ensure your contributions follow the coding style and documentation practices demonstrated in the codebase.

## License

This project is licensed under the **Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International License**.  
To view a copy of this license, visit [http://creativecommons.org/licenses/by-nc-sa/4.0/](http://creativecommons.org/licenses/by-nc-sa/4.0/).

Note: All versions of this project, including all previous commits and any future updates, are licensed under this license.

## Persistent Settings

The application saves **all parameter values**, including file paths, in a JSON settings file (`settings.json`) for convenience. This means that when you run the application again, all your previously entered values are automatically reloaded so you don't have to re-enter them.

## Code Documentation & Comments

The codebase is thoroughly commented to help others understand the simulation mechanics:

- **Agent Update Function (`update_agent`):**  
  - **Nighttime Social Media Use Calculation:**  
    - Uses the agent's baseline SM use.
    - Computes the social norm from the agent's social network.
    - Applies a weighted adjustment, adds a weekend effect (if applicable), and random noise.
    - Caps the value by the household restriction (if any) and ensures non-negativity.
  - **Sleep Duration Calculation:**  
    - Begins with a global baseline.
    - Uses the formula:  
      ```
      new_sleep = Global_Baseline_Sleep - Sleep_Effect_Coefficient * new_SM + noise_sleep
      ```
    - Adds random noise and ensures the sleep duration is not negative.
  
- **CSV Input/Output:**  
  - Detailed instructions are provided on the expected formats for initialization and social network CSV files.
  - **Per-Agent CSV Output:** Each row contains the Run number, AgentID, Day, SleepDuration, and NightSMUse.
  - **Per-Run CSV Output:** Each row contains the Run number, Day, AvgSleepDuration, and AvgNightSMUse.
  - Both CSV files are in standard comma-separated format with a header row.

- **Persistent Settings:**  
  - All parameter values, including file paths, are saved in a JSON file so that users do not need to re-enter any values on subsequent runs.